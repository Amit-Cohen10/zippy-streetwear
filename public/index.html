<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zippy - Futuristic Streetwear Platform</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@300;400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1 class="logo-text">ZIPPY</h1>
                <div class="logo-glow"></div>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link active">Home</a>
                <a href="/products" class="nav-link">Shop</a>
                <a href="/exchange" class="nav-link">Exchange</a>
                <a href="/community" class="nav-link">Community</a>
                <a href="/style-guide" class="nav-link">Style Guide</a>
                <a href="/brands" class="nav-link">Brands</a>
            </div>
            <div class="nav-actions">
                <button class="search-btn" id="searchBtn">
                    <span class="search-icon">üîç</span>
                </button>
                <button class="cart-btn" id="cartBtn">
                    <span class="cart-icon">üõí</span>
                    <span class="cart-count" id="cartCount">0</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-sun" id="themeIcon"></i>
                </button>
                <div class="auth-section">
                    <button class="auth-btn" id="authBtn" onclick="openAuthModal()">LOGIN</button>
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <button class="user-menu-toggle" id="userMenuToggle">
                            <i class="fas fa-user"></i>
                            <span id="usernameDisplay">User</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>

                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ◊°◊ß◊®◊ô◊§◊ò ◊û◊ô◊ô◊ì◊ô ◊ú◊¢◊ì◊õ◊ï◊ü ◊û◊¶◊ë ◊î◊õ◊§◊™◊ï◊® ◊ú◊ú◊ê ◊¢◊ô◊õ◊ï◊ë -->
    <script>
    (function() {
        console.log('‚ö° Immediate button state check...');
        
        // Wait for page to fully load before checking
        function updateButtonWithDelay() {
            // ◊ë◊ì◊ô◊ß◊î ◊û◊ô◊ô◊ì◊ô◊™ ◊©◊ú ◊û◊¶◊ë ◊î◊î◊™◊ó◊ë◊®◊ï◊™
            const savedUser = localStorage.getItem('currentUser');
            let isLoggedIn = false;
            let username = '';
            
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    isLoggedIn = true;
                    username = user.profile?.displayName || user.username || 'User';
                    console.log('‚ö° Found user immediately:', username);
                } catch (e) {
                    console.log('‚ùå Error parsing user data:', e);
                }
            }
            
            // ◊¢◊ì◊õ◊ï◊ü ◊û◊ô◊ô◊ì◊ô ◊õ◊©◊î◊ì◊£ ◊†◊ò◊¢◊ü
            function updateButtonImmediate() {
                const authBtn = document.getElementById('authBtn');
                const userMenu = document.getElementById('userMenu');
                const usernameDisplay = document.getElementById('usernameDisplay');
                
                if (isLoggedIn && username) {
                    // ◊û◊©◊™◊û◊© ◊û◊ó◊ï◊ë◊® - ◊î◊¶◊í ◊ê◊™ ◊©◊ù ◊î◊û◊©◊™◊û◊© ◊û◊ô◊ì
                    if (authBtn) authBtn.style.display = 'none';
                    if (userMenu) userMenu.style.display = 'inline-block';
                    if (usernameDisplay) usernameDisplay.textContent = username;
                    console.log('‚ö° Button set to username immediately:', username);
                } else {
                    // ◊û◊©◊™◊û◊© ◊ú◊ê ◊û◊ó◊ï◊ë◊® - ◊î◊¶◊í LOGIN ◊û◊ô◊ì
                    if (authBtn) authBtn.style.display = 'inline-block';
                    if (userMenu) userMenu.style.display = 'none';
                    console.log('‚ö° Button set to LOGIN immediately');
                }
            }
            
            // ◊†◊°◊î ◊¢◊õ◊©◊ô◊ï ◊û◊ô◊ì, ◊ï◊ê◊ù ◊ú◊ê ◊¢◊ï◊ë◊ì ◊ê◊ñ ◊õ◊©◊î◊ì◊£ ◊ô◊°◊ô◊ô◊ù ◊ú◊ò◊¢◊ï◊ü
            updateButtonImmediate();
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateButtonImmediate);
            }
        }
        
        // Wait a bit before checking to avoid false negatives
        setTimeout(updateButtonWithDelay, 300);
        
        // Also check when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(updateButtonWithDelay, 500);
            });
        }
    })();
    </script>

    <!-- Global Session Timeout System -->
    <script>
    (function() {
        console.log('üåê Global session timeout system initializing...');
        
        let globalSessionCheckInterval = null;
        
        // Initialize global session timeout system
        function initGlobalSessionTimeout() {
            console.log('üåê Initializing global session timeout system...');
            
            // Clear any existing global interval
            if (globalSessionCheckInterval) {
                clearInterval(globalSessionCheckInterval);
            }
            
            // Start global periodic check (every 30 seconds)
            globalSessionCheckInterval = setInterval(async () => {
                const userData = localStorage.getItem('currentUser');
                if (!userData) {
                    console.log('‚ùå No user logged in globally');
                    return;
                }
                
                try {
                    const user = JSON.parse(userData);
                    const rememberMe = user.rememberMe || false;
                    const timeoutMs = rememberMe ? 12 * 24 * 60 * 60 * 1000 : 30 * 60 * 1000;
                    
                    // Get session start time from localStorage or use current time
                    const sessionStartStr = localStorage.getItem('sessionStartTime');
                    const sessionStartTime = sessionStartStr ? parseInt(sessionStartStr) : Date.now();
                    
                    // Check if session has expired
                    const currentTime = Date.now();
                    const sessionAge = currentTime - sessionStartTime;
                    
                    if (sessionAge >= timeoutMs) {
                        console.log('‚è∞ Global session expired, logging out...');
                        forceGlobalLogout();
                        return;
                    }
                    
                    // Also check server session
                    try {
                        const response = await fetch('/api/auth/status', {
                            method: 'GET',
                            credentials: 'include'
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (!data.loggedIn) {
                                console.log('üîí Server session expired globally');
                                forceGlobalLogout();
                                return;
                            }
                        }
                    } catch (error) {
                        console.error('‚ùå Error checking server session globally:', error);
                    }
                    
                    console.log(`‚úÖ Global session valid (${Math.floor((timeoutMs - sessionAge) / 1000)}s remaining)`);
                    
                } catch (error) {
                    console.error('‚ùå Error during global session check:', error);
                }
            }, 30000); // 30 seconds
            
            console.log('üîÑ Global periodic session check started (every 30 seconds)');
        }
        
        // Force global logout
        function forceGlobalLogout() {
            console.log('üîí Force logging out globally due to session timeout');
            
            // Clear ALL localStorage data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userData');
            localStorage.removeItem('userToken');
            localStorage.removeItem('authToken');
            localStorage.removeItem('zippyCart');
            localStorage.removeItem('sessionStartTime');
            localStorage.removeItem('rememberMe');
            localStorage.removeItem('lastLoginTime');
            
            // Clear any other potential auth data
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('user') || key.includes('auth') || key.includes('token') || key.includes('session'))) {
                    localStorage.removeItem(key);
                }
            }
            
            // Reset global state
            window.isLoggedIn = false;
            window.currentUser = null;
            
            // Force server logout
            fetch('/api/auth/logout', {
                method: 'POST',
                credentials: 'include'
            }).catch(error => {
                console.log('Server logout request failed:', error);
            });
            
            // Update UI globally
            updateGlobalAuthUI();
            
            // Show notification
            showGlobalNotification('Session expired. Please log in again.', 'warning');
            
            // Force page reload to ensure complete logout
            setTimeout(() => {
                console.log('üîÑ Reloading page to ensure complete logout...');
                window.location.reload();
            }, 2000);
        }
        
        // Update global auth UI
        function updateGlobalAuthUI() {
            const authBtn = document.getElementById('authBtn');
            const userMenu = document.getElementById('userMenu');
            const usernameDisplay = document.getElementById('usernameDisplay');
            
            if (authBtn) authBtn.style.display = 'inline-block';
            if (userMenu) userMenu.style.display = 'none';
            if (usernameDisplay) usernameDisplay.textContent = 'User';
            
            console.log('üîÑ Global UI updated to show LOGIN button');
        }
        
        // Show global notification
        function showGlobalNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'warning' ? 'rgba(255,193,7,0.9)' : 'rgba(0,255,255,0.9)'};
                color: ${type === 'warning' ? '#000' : '#000'};
                padding: 15px 20px;
                border-radius: 8px;
                border: 2px solid ${type === 'warning' ? '#ffc107' : '#00ffff'};
                z-index: 999999;
                font-weight: 600;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
            
            // Add slideOut animation
            const slideOutStyle = document.createElement('style');
            slideOutStyle.textContent = `
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(slideOutStyle);
        }
        
        // Update session start time when user logs in
        function updateSessionStartTime() {
            localStorage.setItem('sessionStartTime', Date.now().toString());
            console.log('‚è∞ Session start time updated');
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initGlobalSessionTimeout, 1500);
            });
        } else {
            setTimeout(initGlobalSessionTimeout, 1500);
        }
        
        // Make functions globally available
        window.initGlobalSessionTimeout = initGlobalSessionTimeout;
        window.forceGlobalLogout = forceGlobalLogout;
        window.updateGlobalAuthUI = updateGlobalAuthUI;
        window.showGlobalNotification = showGlobalNotification;
        window.updateSessionStartTime = updateSessionStartTime;
        
        console.log('‚úÖ Global session timeout system loaded');
    })();
    </script>

    <!-- User Dropdown Menu (Outside navbar to avoid clipping) -->
    <div class="user-dropdown" id="userDropdown" style="
        background: #1a1a1a !important;
        border: 2px solid #00ffff !important;
        border-radius: 8px !important;
        min-width: 220px !important;
        box-shadow: 0 8px 32px rgba(0, 255, 255, 0.3) !important;
        z-index: 999999 !important;
        display: none !important;
        overflow: visible !important;
        padding: 8px 0 !important;
    ">
        <a href="/dashboard.html" class="dropdown-item" style="
            display: block !important; padding: 12px 16px !important; 
            color: #00ffff !important; text-decoration: none !important;
            border-bottom: 1px solid rgba(0,255,255,0.3) !important;
            transition: all 0.3s ease !important; font-size: 14px !important;
        " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-tachometer-alt" style="margin-right: 10px; width: 16px;"></i> Dashboard
        </a>
        <a href="/my-items.html" class="dropdown-item" style="
            display: block !important; padding: 12px 16px !important; 
            color: #00ffff !important; text-decoration: none !important;
            border-bottom: 1px solid rgba(0,255,255,0.3) !important;
            transition: all 0.3s ease !important; font-size: 14px !important;
        " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-shopping-bag" style="margin-right: 10px; width: 16px;"></i> My Items
        </a>
        <a href="/wishlist.html" class="dropdown-item" style="
            display: block !important; padding: 12px 16px !important; 
            color: #00ffff !important; text-decoration: none !important;
            border-bottom: 1px solid rgba(0,255,255,0.3) !important;
            transition: all 0.3s ease !important; font-size: 14px !important;
        " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-heart" style="margin-right: 10px; width: 16px;"></i> Wishlist
        </a>
        <a href="#" onclick="event.preventDefault(); document.getElementById('cartModal').style.display='flex'; loadCart(); setTimeout(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, 100);" class="dropdown-item" style="
            display: block !important; padding: 12px 16px !important; 
            color: #00ffff !important; text-decoration: none !important;
            border-bottom: 1px solid rgba(0,255,255,0.3) !important;
            transition: all 0.3s ease !important; font-size: 14px !important;
        " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-shopping-cart" style="margin-right: 10px; width: 16px;"></i> My Cart
        </a>
                   <a href="/exchange.html" class="dropdown-item" style="
               display: block !important; padding: 12px 16px !important; 
               color: #00ffff !important; text-decoration: none !important;
               border-bottom: 1px solid rgba(0,255,255,0.3) !important;
               transition: all 0.3s ease !important; font-size: 14px !important;
           " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
               <i class="fas fa-exchange-alt" style="margin-right: 10px; width: 16px;"></i> Exchange
           </a>
           <a href="/admin" class="dropdown-item" style="
               display: block !important; padding: 12px 16px !important; 
               color: #00ffff !important; text-decoration: none !important;
               border-bottom: 1px solid rgba(0,255,255,0.3) !important;
               transition: all 0.3s ease !important; font-size: 14px !important;
           " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='transparent'">
               <i class="fas fa-chart-line" style="margin-right: 10px; width: 16px;"></i> Admin Activity
           </a>
           <div class="dropdown-divider" style="height: 1px; background: rgba(0,255,255,0.3); margin: 8px 0;"></div>
        <button class="dropdown-item logout-item" onclick="logout()" style="
            width: 100% !important; text-align: left !important; 
            background: none !important; border: none !important;
            padding: 12px 16px !important; color: #ff4757 !important; 
            cursor: pointer !important; transition: all 0.3s ease !important; 
            font-size: 14px !important;
        " onmouseover="this.style.background='rgba(255,71,87,0.1)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-sign-out-alt" style="margin-right: 10px; width: 16px;"></i> Logout
        </button>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search products...">
            <div class="search-suggestions" id="searchSuggestions"></div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content cyber-modal">
            <div class="modal-header">
                <h2 class="modal-title">Shopping Cart</h2>
                <button class="modal-close" id="closeCartModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="cartItems" class="cart-items">
                    <!-- Cart items will be populated here -->
                </div>
                <div class="empty-cart" id="emptyCart" style="display: none;">
                    <div class="empty-cart-icon">üõí</div>
                    <h3>Your cart is empty</h3>
                    <p>Add some items to get started!</p>
                </div>
                <div class="cart-summary" id="cartSummary">
                    <div class="summary-item">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span>Shipping:</span>
                        <span id="shipping">$0.00</span>
                    </div>
                    <div class="summary-item total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                    <button class="cyber-btn primary" id="checkoutBtn">Checkout</button>
                    <button class="cyber-btn secondary" onclick="clearCart()">Clear Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-container">
            <div class="auth-header">
                <h3 id="authTitle">Login</h3>
                <button class="close-btn" id="closeAuth">√ó</button>
            </div>
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>
            <form class="auth-form" id="loginForm">
                <input type="text" name="username" placeholder="Username or Email" required>
                <input type="password" name="password" placeholder="Password" required>
                <label class="remember-me">
                    <input type="checkbox" name="rememberMe">
                    <span>Remember me</span>
                </label>
                <button type="submit" class="auth-submit-btn">Login</button>
            </form>
            <form class="auth-form hidden" id="registerForm">
                <input type="text" name="username" placeholder="Username" required>
                <input type="email" name="email" placeholder="Email" required>
                <input type="password" name="password" placeholder="Password" required>
                <input type="password" name="confirmPassword" placeholder="Confirm Password" required>
                <button type="submit" class="auth-submit-btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background">
            <div class="grid-overlay"></div>
            <div class="neon-lines"></div>
        </div>
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="title-line">FUTURISTIC</span>
                <span class="title-line">STREETWEAR</span>
                <span class="title-line">PLATFORM</span>
            </h1>
            <p class="hero-subtitle">Welcome to the future of streetwear. Zippy is where fashion fuses with cutting edge technology, build your digital closet, swap styles in real time, and join a vibrant community of trendsetters.</p>
            <p class="hero-subtitle">Unlock our one of a kind Exchange hub to trade your looks, or dive into the Style Guide for AI powered outfit inspiration. Track your collection, earn badges, and discover exclusive drops you won't find anywhere else.</p>
            <p class="hero-subtitle">Created by Amit Cohen & Ariel Sinai.</p>
            <div class="hero-actions">
                <button class="cta-btn primary" onclick="window.location.href='/products'">
                    <span>Shop Now</span>
                    <div class="btn-glow"></div>
                </button>
                <button class="cta-btn secondary" onclick="window.location.href='/exchange'">
                    <span>Start Exchanging</span>
                    <div class="btn-glow"></div>
                </button>
            </div>
        </div>
        <div class="hero-visual">
            <div class="floating-elements">
                <div class="floating-item" data-speed="0.5">üëï</div>
                <div class="floating-item" data-speed="0.8">üëñ</div>
                <div class="floating-item" data-speed="0.3">üß•</div>
                <div class="floating-item" data-speed="0.6">üëü</div>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="featured-products">
        <div class="container">
            <h2 class="section-title">Featured Products</h2>
            <div class="products-grid" id="featuredProducts">
                <!-- Products will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Exchange Hub Preview -->
    <section class="exchange-preview">
        <div class="container">
            <div class="preview-content">
                <h2 class="section-title">Clothing Exchange</h2>
                <p class="preview-text">Our unique exchange system lets you trade clothes with other fashion enthusiasts. Build your community and discover new styles.</p>
                <div class="exchange-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="exchangeCount">0</span>
                        <span class="stat-label">Active Exchanges</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="userCount">0</span>
                        <span class="stat-label">Community Members</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="ratingAvg">0.0</span>
                        <span class="stat-label">Average Rating</span>
                    </div>
                </div>
                <button class="cta-btn primary" onclick="window.location.href='/exchange'">
                    <span>Join Exchange Hub</span>
                    <div class="btn-glow"></div>
                </button>
            </div>
            <div class="preview-visual">
                <div class="exchange-animation">
                    <div class="exchange-item">üëï</div>
                    <div class="exchange-arrow">‚áÑ</div>
                    <div class="exchange-item">üëñ</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="categories">
        <div class="container">
            <h2 class="section-title">Shop by Category</h2>
            <div class="categories-grid">
                <div class="category-card" onclick="window.location.href='/products?category=hoodies'">
                    <div class="category-icon">üß•</div>
                    <h3>Hoodies</h3>
                    <p>Futuristic streetwear hoodies</p>
                </div>
                <div class="category-card" onclick="window.location.href='/products?category=t-shirts'">
                    <div class="category-icon">üëï</div>
                    <h3>T-Shirts</h3>
                    <p>Graphic tees and streetwear</p>
                </div>
                <div class="category-card" onclick="window.location.href='/products?category=pants'">
                    <div class="category-icon">üëñ</div>
                    <h3>Pants</h3>
                    <p>Cargo pants and streetwear</p>
                </div>
                
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Zippy</h3>
                    <p>Futuristic streetwear platform with innovative clothing exchange.</p>
                    <div class="social-links">
                        <a href="#" class="social-link">üì±</a>
                        <a href="#" class="social-link">üì∑</a>
                        <a href="#" class="social-link">üê¶</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul>
                        <li><a href="/products">All Products</a></li>
                        <li><a href="/exchange">Exchange Hub</a></li>
                        <li><a href="/brands">Brands</a></li>
                        <li><a href="/style-guide">Style Guide</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="/community">Community Feed</a></li>
                        <li><a href="/sustainability">Sustainability</a></li>
                        <li><a href="/fitting-room">Virtual Fitting</a></li>
                    </ul>
                </div>

            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Zippy. All rights reserved. | Created by Amit Cohen & Ariel Sinai</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-text">ZIPPY</div>
        </div>
    </div>

    <!-- Add to Cart Modal -->
    <div class="add-to-cart-modal" id="addToCartModal">
        <div class="add-to-cart-container">
            <div class="add-to-cart-header">
                <h3>Add to Cart</h3>
                <p>Product added successfully!</p>
            </div>
            <div class="add-to-cart-product" id="addToCartProduct">
                <!-- Product details will be populated here -->
            </div>
            <div class="add-to-cart-actions">
                <button class="add-to-cart-btn" onclick="addToCartAndClose()">Add to Cart</button>
                <button class="add-to-cart-close-btn" onclick="closeAddToCartModal()">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/scripts/global.js"></script>
    <script src="/scripts/main.js"></script>
    <script src="/scripts/auth.js"></script>
    <script src="/scripts/cart.js"></script>
    <script src="/scripts/search.js"></script>
    <script src="/scripts/simple-user-menu.js"></script>
    
    <!-- Handle login redirect -->
    <script>
        // Check if user was redirected here for login
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const loginRequired = urlParams.get('login');
            
            if (loginRequired === 'required') {
                console.log('üîê Login required - checking if user is already logged in');
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    try {
                        const user = JSON.parse(savedUser);
                        console.log('‚úÖ User already logged in:', user.username || 'User');
                        // Remove the login=required parameter from URL
                        const newUrl = window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                        return;
                    } catch (e) {
                        console.log('‚ùå Error parsing user data, removing invalid data');
                        localStorage.removeItem('currentUser');
                    }
                }
                
                console.log('üîê No user found, opening auth modal');
                
                // Function to try opening the modal
                function tryOpenModal() {
                    if (typeof openAuthModal === 'function') {
                        console.log('‚úÖ openAuthModal function found, opening modal');
                        openAuthModal();
                        return true;
                    } else {
                        console.log('‚ùå openAuthModal function not available yet');
                        return false;
                    }
                }
                
                // Function to check if auth system is ready
                function isAuthSystemReady() {
                    return typeof openAuthModal === 'function' && 
                           typeof updateAuthUI === 'function' &&
                           typeof forceUpdateAuthButton === 'function';
                }
                
                // Try immediately
                if (!tryOpenModal()) {
                    // If not available, try again after a short delay
                    setTimeout(() => {
                        if (!tryOpenModal()) {
                            // If still not available, try again after longer delay
                            setTimeout(() => {
                                if (!tryOpenModal()) {
                                    console.log('‚ùå Failed to open auth modal after multiple attempts');
                                    // Force update UI and try one more time
                                    if (typeof forceUpdateAuthButton === 'function') {
                                        forceUpdateAuthButton();
                                    }
                                    setTimeout(() => {
                                        if (!tryOpenModal()) {
                                            // Final fallback: show a simple alert
                                            alert('Please click the LOGIN button to sign in.');
                                        }
                                    }, 1000);
                                }
                            }, 2000);
                        }
                    }, 500);
                }
            }
            
            // Check session status on page load
            setTimeout(() => {
                if (typeof checkSessionStatus === 'function') {
                    checkSessionStatus();
                }
                
                // Setup admin access checks
                if (typeof setupAdminAccessChecks === 'function') {
                    setupAdminAccessChecks();
                }
            }, 1000);
        });
    </script>
</body>
</html> 